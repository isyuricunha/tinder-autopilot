(function(){"use strict";function ye(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _={exports:{}},ve=_.exports,te;function Te(){return te||(te=1,(function(e,s){(function(t,n){n(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ve,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const n="The message port closed before a response was received.",i=r=>{const d={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(d).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class A extends WeakMap{constructor(c,u=void 0){super(u),this.createItem=c}get(c){return this.has(c)||this.set(c,this.createItem(c)),super.get(c)}}const E=l=>l&&typeof l=="object"&&typeof l.then=="function",F=(l,c)=>(...u)=>{r.runtime.lastError?l.reject(new Error(r.runtime.lastError.message)):c.singleCallbackArg||u.length<=1&&c.singleCallbackArg!==!1?l.resolve(u[0]):l.resolve(u)},T=l=>l==1?"argument":"arguments",Ne=(l,c)=>function(m,...b){if(b.length<c.minArgs)throw new Error(`Expected at least ${c.minArgs} ${T(c.minArgs)} for ${l}(), got ${b.length}`);if(b.length>c.maxArgs)throw new Error(`Expected at most ${c.maxArgs} ${T(c.maxArgs)} for ${l}(), got ${b.length}`);return new Promise((S,k)=>{if(c.fallbackToNoCallback)try{m[l](...b,F({resolve:S,reject:k},c))}catch(g){console.warn(`${l} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,g),m[l](...b),c.fallbackToNoCallback=!1,c.noCallback=!0,S()}else c.noCallback?(m[l](...b),S()):m[l](...b,F({resolve:S,reject:k},c))})},Se=(l,c,u)=>new Proxy(c,{apply(m,b,S){return u.call(b,l,...S)}});let z=Function.call.bind(Object.prototype.hasOwnProperty);const $=(l,c={},u={})=>{let m=Object.create(null),b={has(k,g){return g in l||g in m},get(k,g,y){if(g in m)return m[g];if(!(g in l))return;let h=l[g];if(typeof h=="function")if(typeof c[g]=="function")h=Se(l,l[g],c[g]);else if(z(u,g)){let L=Ne(g,u[g]);h=Se(l,l[g],L)}else h=h.bind(l);else if(typeof h=="object"&&h!==null&&(z(c,g)||z(u,g)))h=$(h,c[g],u[g]);else if(z(u,"*"))h=$(h,c[g],u["*"]);else return Object.defineProperty(m,g,{configurable:!0,enumerable:!0,get(){return l[g]},set(L){l[g]=L}}),h;return m[g]=h,h},set(k,g,y,h){return g in m?m[g]=y:l[g]=y,!0},defineProperty(k,g,y){return Reflect.defineProperty(m,g,y)},deleteProperty(k,g){return Reflect.deleteProperty(m,g)}},S=Object.create(l);return new Proxy(S,b)},X=l=>({addListener(c,u,...m){c.addListener(l.get(u),...m)},hasListener(c,u){return c.hasListener(l.get(u))},removeListener(c,u){c.removeListener(l.get(u))}}),Ue=new A(l=>typeof l!="function"?l:function(u){const m=$(u,{},{getContent:{minArgs:0,maxArgs:0}});l(m)}),xe=new A(l=>typeof l!="function"?l:function(u,m,b){let S=!1,k,g=new Promise(j=>{k=function(I){S=!0,j(I)}}),y;try{y=l(u,m,k)}catch(j){y=Promise.reject(j)}const h=y!==!0&&E(y);if(y!==!0&&!h&&!S)return!1;const L=j=>{j.then(I=>{b(I)},I=>{let ee;I&&(I instanceof Error||typeof I.message=="string")?ee=I.message:ee="An unexpected error occurred",b({__mozWebExtensionPolyfillReject__:!0,message:ee})}).catch(I=>{console.error("Failed to send onMessage rejected reply",I)})};return L(h?y:g),!0}),Be=({reject:l,resolve:c},u)=>{r.runtime.lastError?r.runtime.lastError.message===n?c():l(new Error(r.runtime.lastError.message)):u&&u.__mozWebExtensionPolyfillReject__?l(new Error(u.message)):c(u)},ke=(l,c,u,...m)=>{if(m.length<c.minArgs)throw new Error(`Expected at least ${c.minArgs} ${T(c.minArgs)} for ${l}(), got ${m.length}`);if(m.length>c.maxArgs)throw new Error(`Expected at most ${c.maxArgs} ${T(c.maxArgs)} for ${l}(), got ${m.length}`);return new Promise((b,S)=>{const k=Be.bind(null,{resolve:b,reject:S});m.push(k),u.sendMessage(...m)})},ze={devtools:{network:{onRequestFinished:X(Ue)}},runtime:{onMessage:X(xe),onMessageExternal:X(xe),sendMessage:ke.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:ke.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},q={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return d.privacy={network:{"*":q},services:{"*":q},websites:{"*":q}},$(r,ze,d)};t.exports=i(chrome)}})})(_)),_.exports}var Ie=Te();const o=ye(Ie);class Ee{constructor(){this.maxLogs=1e3,this.storageKey="autoSwiper_logs",this.context=this.detectContext(),this.version=null,this.logs=[],this.init()}async init(){try{const s=o.runtime.getManifest();this.version=s.version,await this.loadLogs()}catch(s){console.error("Logger initialization failed:",s),this.version="unknown"}}detectContext(){try{return typeof window<"u"&&window.location?"content":typeof document<"u"?"popup":"background"}catch{return"unknown"}}formatLogEntry(s,t,n={}){const i={timestamp:Date.now(),level:s,message:t,context:this.context,data:n,version:this.version};return this.context==="content"&&typeof window<"u"&&window.location&&(i.url=window.location.href),i}outputToConsole(s){const n=`[${new Date(s.timestamp).toISOString().substr(11,12)}] [${s.context}] [${s.level.toUpperCase()}]`,i=s.data&&Object.keys(s.data).length>0;switch(s.level){case"error":console.error(n,s.message,i?s.data:"");break;case"warn":console.warn(n,s.message,i?s.data:"");break;case"debug":console.debug(n,s.message,i?s.data:"");break;default:console.log(n,s.message,i?s.data:"")}}sanitizeData(s){if(!s||typeof s!="object")return s;const t={...s},n=["token","password","key","secret","auth","api_key","apikey"];for(const i in t){const r=i.toLowerCase();n.some(d=>r.includes(d))&&(t[i]="[REDACTED]")}return t}async addLog(s,t,n={}){try{const i=this.sanitizeData(n),r=this.formatLogEntry(s,t,i);this.outputToConsole(r),this.logs.push(r),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs)),this.saveLogs().catch(d=>{d.message&&d.message.includes("Extension context invalidated")||console.error("Failed to save logs:",d)})}catch(i){console.error("Logger.addLog failed:",i)}}info(s,t={}){this.addLog("info",s,t)}warn(s,t={}){this.addLog("warn",s,t)}error(s,t={}){this.addLog("error",s,t)}debug(s,t={}){this.addLog("debug",s,t)}async loadLogs(){try{const t=(await o.storage.local.get(this.storageKey))[this.storageKey];return Array.isArray(t)?this.logs=t:this.logs=[],this.logs}catch(s){return s.message&&s.message.includes("Extension context invalidated")?(this.logs=[],this.logs):(console.error("Failed to load logs from storage:",s),this.logs=[],this.logs)}}async saveLogs(){try{await o.storage.local.set({[this.storageKey]:this.logs})}catch(s){if(s.message&&s.message.includes("Extension context invalidated"))return;if(console.error("Failed to save logs to storage:",s),s.message&&s.message.includes("QUOTA_BYTES")){this.logs=this.logs.slice(-Math.floor(this.maxLogs/2));try{await o.storage.local.set({[this.storageKey]:this.logs})}catch(t){if(t.message&&t.message.includes("Extension context invalidated"))return;console.error("Failed to save logs even after cleanup:",t)}}}}async clearLogs(){try{this.logs=[],await o.storage.local.remove(this.storageKey),this.info("Logs cleared successfully")}catch(s){throw console.error("Failed to clear logs:",s),s}}async getLogCount(){return this.logs.length}async exportLogs(){try{let s={};if(typeof localStorage<"u")try{const i=localStorage.getItem("main-store");i?(s=JSON.parse(i),delete s.log,delete s.isSwiping,delete s.lastSwipeProfile,delete s.lastHeartbeat,delete s.lastActivity,delete s.subscriptionCheckAttempts,console.log("Found main-store in DOM localStorage")):console.log("main-store not found in DOM localStorage")}catch(i){console.error("Error parsing main-store from localStorage:",i)}else console.log("DOM localStorage not available in this context");console.log("Final options object:",s);const t=await this.loadLogs(),n={logs:t,options:s,exportDate:new Date().toISOString(),version:this.version,logCount:t.length,contexts:[...new Set(t.map(i=>i.context))],timeRange:t.length>0?{start:new Date(t[0].timestamp).toISOString(),end:new Date(t[t.length-1].timestamp).toISOString()}:null};return this.info("Options: Logs exported by user",{filename:`auto-swiper-logs-${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.json`,logCount:t.length}),n}catch(s){throw this.error("Failed to export logs",{error:s.message}),s}}async getLogsForDisplay(s=50){return(await this.loadLogs()).slice(-s).reverse()}async getLogsByLevel(s){return(await this.loadLogs()).filter(n=>n.level===s)}async getLogsByContext(s){return(await this.loadLogs()).filter(n=>n.context===s)}async getStorageStats(){const s=await this.loadLogs(),t=JSON.stringify(s).length;return{totalLogs:s.length,maxLogs:this.maxLogs,storageUsed:t,storageUsedKB:Math.round(t/1024*100)/100,oldestLog:s.length>0?new Date(s[0].timestamp).toISOString():null,newestLog:s.length>0?new Date(s[s.length-1].timestamp).toISOString():null}}}const a=new Ee,R="https://app.auto-swiper.ch/api/v3",se=R+"/login",ae=R+"/sessions/start",ie=R+"/sessions/end",ne=R+"/scheduled-sessions/next",oe=R+"/heartbeat";async function H(){const e=await o.storage.local.get({withDebuggerOutput:null});e.withDebuggerOutput!==null&&e.withDebuggerOutput}H();async function re(){const e=await o.storage.local.get({withImageBlocking:null});return e.withImageBlocking!==null?e.withImageBlocking:null}const W=async(e,s,t)=>{if(e.loginEmail.length<4||e.loginPassword.length<4)return;const n={method:"GET",url:se,params:{uuid:e.uuid},auth:{username:e.loginEmail.toLowerCase(),password:e.loginPassword},headers:{Accept:"application/json","Content-Type":"application/json"}};try{let r=(await s.request(n)).data;e.loginToken=r.data.token,await o.storage.local.set({loginToken:r.data.token})}catch(i){a.error("Auth token request failed",{error:i.message}),t.warning(o.i18n.getMessage("ERROR_LOGIN_REQUEST"))}},le=async(e,s,t)=>{if(!e.loginToken||e.loginToken.length<20)throw new Error("No valid authentication token");const n=new URL(ne);n.searchParams.append("uuid",e.uuid);const i={method:"GET",headers:{Authorization:"Bearer "+e.loginToken,"Content-Type":"application/json"}};try{const r=await fetch(n.toString(),i);if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const d=await r.json();return a.info("Next scheduled session retrieved",{sessionData:d}),d}catch(r){throw a.error("Error getting next scheduled session",{error:r.message}),r}},Me=async(e,s,t,n)=>{if(!s.loginToken||s.loginToken.length<20)if(t)await W(s,t,n);else throw new Error("No valid authentication token");const i={method:"POST",headers:{Authorization:"Bearer "+s.loginToken,"Content-Type":"application/json"},body:JSON.stringify({uuid:s.uuid,site:e.site,scheduled_session_id:e.scheduled_session_id||null})};try{const r=await fetch(ae,i);if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const d=await r.json();return a.info("Session started successfully",{sessionData:d}),n&&n.success("Session started successfully"),d}catch(r){throw a.error("Error starting session",{error:r.message}),n&&n.error("Failed to start session: "+r.message),r}},ce=async(e,s,t,n,i)=>{if(!t.loginToken||t.loginToken.length<20)throw new Error("No valid authentication token");const r={method:"PUT",headers:{Authorization:"Bearer "+t.loginToken,"Content-Type":"application/json"},body:JSON.stringify({uuid:t.uuid,session_id:e,swipes_left:0,swipes_right:0,swipes_total:0,status:"failed",failure_reason:s.reason||"Session execution failed",error_details:{error_message:s.message||"Unknown error",error_stack:s.stack,timestamp:s.timestamp||new Date().toISOString(),session_type:s.session_type||"regular"},ended_at:new Date().toISOString()})};try{const d=await fetch(ie,r);if(!d.ok)throw new Error(`HTTP ${d.status}: ${d.statusText}`);const A=await d.json();return a.info("Session failure reported",{sessionData:A,errorDetails:s}),A}catch(d){throw a.error("Error reporting session failure",{error:d.message}),d}},de=async(e,s,t,n)=>{if(!s.loginToken||s.loginToken.length<20)if(t)await W(s,t,n);else throw new Error("No valid authentication token");const i={method:"POST",headers:{Authorization:"Bearer "+s.loginToken,"Content-Type":"application/json"},body:JSON.stringify({uuid:s.uuid,...e})};try{const r=await fetch(oe,i);if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const d=await r.json();return a.debug("Heartbeat sent successfully",{heartbeatData:d}),d}catch(r){throw a.error("Error sending heartbeat",{error:r.message}),r}},De=Object.freeze(Object.defineProperty({__proto__:null,endSessionUrl:ie,failSession:ce,getAuthToken:W,getNextScheduledSession:le,getNextScheduledSessionUrl:ne,getWithImageBlocking:re,heartbeatUrl:oe,loadWithDebuggerOutput:H,loginUrl:se,sendHeartbeat:de,startSession:Me,startSessionUrl:ae},Symbol.toStringTag,{value:"Module"}));function Pe(e){o.notifications.create({type:"basic",iconUrl:"icons/icon_128.png",title:"Auto Swiper",message:e})}const Ce=async(e,s)=>Math.random()*(s-e)+e,K=async()=>{const e=await o.storage.local.get({longitude:null,latitude:null});await o.scripting.unregisterContentScripts({ids:["protected","unprotected"]}).catch(()=>{}),e.longitude!==null&&await o.scripting.registerContentScripts([{id:"unprotected",matches:["*://*/*"],allFrames:!0,matchOriginAsFallback:!0,runAt:"document_start",js:["unprotected.js"],world:"MAIN"},{id:"protected",matches:["*://*/*"],allFrames:!0,matchOriginAsFallback:!0,runAt:"document_start",js:["protected.js"],world:"ISOLATED"}])},Le=async()=>{(await o.tabs.query({url:["*://tinder.com/*","*://*.tinder.com/*","*://bumble.com/app/*","*://*.bumble.com/app/*","*://lovoo.com/*","*://*.lovoo.com/*","*://okcupid.com/*","*://*.okcupid.com/*","*://badoo.com/*","*://*.badoo.com/*","*://pof.com/*","*://*.pof.com/*","*://zoosk.com/*","*://*.zoosk.com/*","*://match.com/d/*","*://*.match.com/d/*"]})).forEach(function(s){o.tabs.reload(s.id)})};chrome.runtime.onStartup.addListener(K),chrome.runtime.onInstalled.addListener(K);let P=!1,w=null,G=!1,f=null,N=null;const v=new Set,Re=async(e,s,t)=>{try{await o.tabs.get(e)}catch{a.warn("Tab does not exist, skipping sendDebuggerMousePressedCommand",{tabId:e});return}const n=()=>{v.add(e),chrome.debugger.sendCommand({tabId:e},"Input.dispatchMouseEvent",{type:"mousePressed",x:s,y:t,button:"left",clickCount:1},()=>{chrome.debugger.sendCommand({tabId:e},"Input.dispatchMouseEvent",{type:"mouseReleased",x:s,y:t,button:"left",clickCount:1},()=>{})})};v.has(e)?n():chrome.debugger.attach({tabId:e},"1.2",n)},Oe=async(e,s)=>{try{await o.tabs.get(e)}catch{a.warn("Tab does not exist, skipping sendDebuggerKeyEventCommand",{tabId:e});return}const t={type:"keyDown",key:"ArrowDown",code:"ArrowDown"};t.key=s.key.toString(),t.code=s.code.toString();const n=()=>{v.add(e),chrome.debugger.sendCommand({tabId:e},"Input.dispatchKeyEvent",t,function(i){t.type="keyUp",chrome.debugger.sendCommand({tabId:e},"Input.dispatchKeyEvent",t,()=>{})})};v.has(e)?n():chrome.debugger.attach({tabId:e},"1.2",n)};let D=!1,p=null,x=1;const ge=async()=>{try{if(!p||!p.minMaxSwipeTime||!Array.isArray(p.minMaxSwipeTime)){a.error("Invalid options or minMaxSwipeTime in loop",{options:p});return}(typeof x!="number"||isNaN(x))&&(a.error("Invalid siteSwipeSpeedModifier in loop",{siteSwipeSpeedModifier:x}),x=1);const e=await Ce(p.minMaxSwipeTime[0]*x*1e3,p.minMaxSwipeTime[1]*x*1e3);if(a.debug("Loop timeout calculated",{timeout:e}),isNaN(e)||e<=0){a.error("Invalid timeout calculated",{timeout:e});return}const s=Date.now()+e;setTimeout(function(){if(D){a.info("Loop stopped, not continuing");return}a.debug("sent: auto-swiper-message-contentjs-check-loop"),o.tabs.get(p.tabId).then(()=>{o.tabs.sendMessage(p.tabId,{action:"auto-swiper-message-contentjs-check-loop"})}).catch(()=>{a.warn("Tab does not exist, skipping sendMessage in loop",{tabId:p.tabId})}),o.alarms.create("auto-swiper-alarm-loop",{when:s})},e)}catch(e){a.error("Error in loop function",{error:e.message})}},Fe=async()=>{let e=await re();a.debug("Image blocking status",{withImageBlocking:e}),e?chrome.declarativeNetRequest.updateSessionRules({addRules:[{id:1,priority:1,action:{type:"block"},condition:{urlFilter:"*://images-ssl.gotinder.com",resourceTypes:["image"]}},{id:2,priority:2,action:{type:"block"},condition:{urlFilter:"*://*.bumbcdn.com",resourceTypes:["image"]}},{id:3,priority:3,action:{type:"block"},condition:{urlFilter:"*://img.lovoo.com",resourceTypes:["image"]}},{id:4,priority:4,action:{type:"block"},condition:{urlFilter:"*://cdn.okccdn.com",resourceTypes:["image"]}},{id:5,priority:5,action:{type:"block"},condition:{urlFilter:"*://*.badoocdn.com",resourceTypes:["image"]}},{id:6,priority:6,action:{type:"block"},condition:{urlFilter:"*://pics.pof.com",resourceTypes:["image"]}},{id:7,priority:7,action:{type:"block"},condition:{urlFilter:"*://*.zoosk.com",resourceTypes:["image"]}},{id:8,priority:8,action:{type:"block"},condition:{urlFilter:"*://*.akamaihd.net/photo/",resourceTypes:["image"]}}]}):chrome.declarativeNetRequest.updateSessionRules({removeRuleIds:[1,2,3,4,5,6,7]})};o.runtime.onMessage.addListener(async function(e,s,t){if(e.action==="startAuthenticatedServices"){a.info("Received request to start authenticated services"),await Y();return}if(e.action==="stopAuthenticatedServices"){a.info("Received request to stop authenticated services"),await M();return}if(e.action==="auto-swiper-message-backgroundjs-start"){a.info("received: auto-swiper-message-backgroundjs-start");let n="https://tinder.com/app/recs",i="*://tinder.com/app/*";switch(e.options.site){case"tinder":n="https://tinder.com/app/recs",i="*://*.tinder.com/app/*";break;case"bumble":n="https://bumble.com/app",i="*://*.bumble.com/app/*";break;case"lovoo":n="https://www.lovoo.com/match",i="*://*.lovoo.com/*";break;case"okcupid":n="https://www.okcupid.com/discover",i="*://*.okcupid.com/*";break;case"badoo":n="https://www.badoo.com/encounters",i="*://*.badoo.com/*";break;case"pof":n="https://www.pof.com/meetme",i="*://*.pof.com/*";break;case"zoosk":n="https://www.zoosk.com/personals/search",i="*://*.zoosk.com/personals/*";break;case"match":n="https://match.com",i="*://*.match.com/d/*";break}o.tabs.query({url:i}).then(r=>{if(r.length>0){const d=parseInt(r[0].id.toString());o.tabs.update(d,{active:!0}).then(async()=>{e.options.tabId=d,w=e,P=!0;try{await o.tabs.get(w.options.tabId),await o.tabs.sendMessage(w.options.tabId,{action:"auto-swiper-message-contentjs-ignore-unload"}),await o.tabs.reload(e.options.tabId)}catch{a.warn("Tab does not exist, skipping sendMessage/reload",{tabId:w.options.tabId})}})}else o.tabs.create({url:n}).then(async d=>{const A=parseInt(d.id.toString());e.options.tabId=A,w=e,P=!0})})}if(e.action==="auto-swiper-message-backgroundjs-send-notification"&&(a.info("received: auto-swiper-message-backgroundjs-send-notification"),Pe(e.message)),e.action==="auto-swiper-message-backgroundjs-reload-tab"&&(a.info("received: auto-swiper-message-backgroundjs-reload-tab"),D=!0,v.has(e.tabId)?o.tabs.get(e.tabId).then(()=>{chrome.debugger.detach({tabId:e.tabId},()=>{v.delete(e.tabId)})}).catch(()=>{a.warn("Tab does not exist, skipping debugger.detach",{tabId:e.tabId})}):a.debug("Debugger is not attached to tab, skipping detach",{tabId:e.tabId}),G=!0,f=e,o.tabs.get(e.options.tabId).then(()=>{o.tabs.reload(e.options.tabId)}).catch(()=>{a.warn("Tab does not exist, skipping reload",{tabId:e.options.tabId})})),e.action==="auto-swiper-message-backgroundjs-loaded"&&P&&(a.info("received: auto-swiper-message-backgroundjs-loaded start after reload"),P=!1,o.tabs.get(w.options.tabId).then(()=>{o.tabs.sendMessage(w.options.tabId,{action:"auto-swiper-message-contentjs-start",options:w.options})}).catch(()=>{a.warn("Tab does not exist, skipping sendMessage (start after reload)",{tabId:w.options.tabId})})),e.action==="auto-swiper-message-backgroundjs-loaded"&&G&&(a.info("received: auto-swiper-message-backgroundjs-loaded"),a.debug("reload request data",{reloadRequest:f}),G=!1,f.options.enableDelayAfterPageReload?(a.info("alarm set for delay after page reload",{delayMinutes:f.options.delayAfterPageReload}),o.alarms.create("auto-swiper-alarm-start",{delayInMinutes:f.options.delayAfterPageReload})):(a.info("auto-swiper will start after 5 seconds"),setTimeout(function(){a.debug("sent: auto-swiper-message-contentjs-start-after-tab-reload"),a.debug("card tries data",{cardTries:f.cardTries}),o.tabs.get(f.options.tabId).then(()=>{o.tabs.sendMessage(f.options.tabId,{action:"auto-swiper-message-contentjs-start-after-tab-reload",swipeCounts:f.swipeCounts,options:f.options,cardTries:f.cardTries})}).catch(()=>{a.warn("Tab does not exist, skipping sendMessage (start after tab reload)",{tabId:f.options.tabId})})},5e3))),e.action==="auto-swiper-message-backgroundjs-spoof-location"&&(a.info("received: auto-swiper-message-backgroundjs-spoof-location"),K(),Le()),e.action==="auto-swiper-message-backgroundjs-simulate-mouse-click"&&(a.debug("received: auto-swiper-message-backgroundjs-simulate-mouse-click"),Re(e.tabId,e.x,e.y)),e.action==="auto-swiper-message-backgroundjs-simulate-key-event"&&(a.debug("received: auto-swiper-message-backgroundjs-simulate-key-event"),Oe(e.tabId,e.keyData)),e.action==="auto-swiper-message-backgroundjs-start-loop")try{H(),a.info("received: auto-swiper-message-backgroundjs-start-loop"),a.debug("siteSwipeSpeedModifier from request",{siteSwipeSpeedModifier:e.siteSwipeSpeedModifier}),D=!1,p=e.options,typeof e.siteSwipeSpeedModifier=="number"&&!isNaN(e.siteSwipeSpeedModifier)?x=e.siteSwipeSpeedModifier:(x=1,a.debug("Using default siteSwipeSpeedModifier",{value:1})),a.debug("siteSwipeSpeedModifier set",{siteSwipeSpeedModifier:x}),(!p.minMaxSwipeTime||!Array.isArray(p.minMaxSwipeTime)||p.minMaxSwipeTime.length<2)&&(a.warn("Invalid minMaxSwipeTime, setting default",{minMaxSwipeTime:p.minMaxSwipeTime}),p.minMaxSwipeTime=[1e3,3e3]),a.debug("Calling loop() function"),ge()}catch(n){a.error("Error in start-loop handler",{error:n.message})}e.action==="auto-swiper-message-backgroundjs-stop-loop"&&(a.info("received: auto-swiper-message-backgroundjs-stop-loop"),D=!0,p=null,x=1,v.has(e.tabId)?o.tabs.get(e.tabId).then(()=>{chrome.debugger.detach({tabId:e.tabId},()=>{v.delete(e.tabId)})}).catch(()=>{a.warn("Tab does not exist, skipping debugger.detach (stop-loop)",{tabId:e.tabId})}):a.debug("Debugger is not attached to tab, skipping detach (stop-loop)",{tabId:e.tabId})),e.action==="auto-swiper-message-backgroundjs-stopped"&&(a.info("received: auto-swiper-message-backgroundjs-stopped"),D=!0,x=1,v.has(e.tabId)?o.tabs.get(e.tabId).then(()=>{chrome.debugger.detach({tabId:e.tabId},()=>{v.delete(e.tabId)})}).catch(()=>{a.warn("Tab does not exist, skipping debugger.detach (stopped)",{tabId:e.tabId})}):a.debug("Debugger is not attached to tab, skipping detach (stopped)",{tabId:e.tabId})),e.action==="auto-swiper-message-backgroundjs-create-restart-alarm"&&(a.info("received: auto-swiper-message-backgroundjs-create-restart-alarm"),D=!0,p=null,x=1,N=e,a.info("created: auto-swiper-alarm-restart"),a.info("auto-swiper break duration set",{breakDurationMins:e.breakDuration}),o.alarms.create("auto-swiper-alarm-restart",{delayInMinutes:e.breakDuration})),e.action==="auto-swiper-message-backgroundjs-toggle-image-blocking"&&(a.info("Received message: auto-swiper-message-backgroundjs-toggle-image-blocking"),Fe()),t()}),o.alarms.onAlarm.addListener(function(e){e.name==="auto-swiper-alarm-start"&&(a.info("received: auto-swiper-alarm-start"),a.debug("sent: auto-swiper-message-contentjs-start-after-tab-reload"),a.debug("card tries data",{cardTries:f.cardTries}),o.tabs.sendMessage(f.options.tabId,{action:"auto-swiper-message-contentjs-start-after-tab-reload",swipeCounts:f.swipeCounts,options:f.options,cardTries:f.cardTries}),chrome.alarms.clear("auto-swiper-alarm-start")),e.name==="auto-swiper-alarm-loop"&&(a.debug("received: auto-swiper-alarm-loop"),ge(),chrome.alarms.clear("auto-swiper-alarm-loop")),e.name==="auto-swiper-alarm-restart"&&(a.info("received: auto-swiper-alarm-restart"),a.debug("sent: auto-swiper-message-contentjs-restart"),o.tabs.get(N.options.tabId).then(()=>{o.tabs.sendMessage(N.options.tabId,{action:"auto-swiper-message-contentjs-restart"})}).catch(()=>{a.warn("Tab does not exist, skipping sendMessage (restart)",{tabId:N.options.tabId})}),chrome.alarms.clear("auto-swiper-alarm-restart"))});const U="heartbeat",ue=5;let V=0;const B="scheduled-session-polling",Z=5;let J=!1;async function me(){a.info("Initializing heartbeat system");const e=await o.storage.local.get({loginToken:"",uuid:"",instanceRegistered:!1});if(!e.loginToken||!e.uuid||!e.instanceRegistered){a.debug("Skipping heartbeat initialization - user not logged in or registered");return}await o.alarms.clear(U),await o.alarms.create(U,{delayInMinutes:ue,periodInMinutes:ue}),await o.storage.local.set({heartbeatStatus:"connected",lastActivity:new Date().toISOString()}),await Q(),a.info("Heartbeat system initialized")}function pe(){const e=navigator.userAgent;let s="unknown",t="unknown",n=navigator.platform||"unknown";if(e.includes("Chrome")){s="chrome";const i=e.match(/Chrome\/([0-9.]+)/);t=i?i[1]:"unknown"}else if(e.includes("Firefox")){s="firefox";const i=e.match(/Firefox\/([0-9.]+)/);t=i?i[1]:"unknown"}else if(e.includes("Safari")){s="safari";const i=e.match(/Version\/([0-9.]+)/);t=i?i[1]:"unknown"}return{browser:s,version:t,platform:n}}async function he(){try{const e=await o.storage.local.get({isSwiping:!1,currentScheduledSession:null,scheduledSessionStatus:"idle",lastActivity:null});return{status:e.isSwiping?"active":e.scheduledSessionStatus||"idle",current_session_id:e.currentScheduledSession||null,last_activity:e.lastActivity||new Date().toISOString()}}catch(e){return a.error("Error getting extension status",{error:e.message}),{status:"idle",current_session_id:null,last_activity:new Date().toISOString()}}}async function Q(){const e=Date.now();if(!(e-V<6e4))try{if(!await C()){a.debug("Skipping heartbeat - authentication validation failed"),await M();return}const t=await o.storage.local.get({loginToken:"",uuid:"",instanceRegistered:!1}),n=pe(),i=await he(),r={instance_id:t.uuid,status:i.status,current_session_id:i.current_session_id,extension_version:o.runtime.getManifest().version,browser_info:n,timestamp:new Date().toISOString()},d={loginToken:t.loginToken,uuid:t.uuid};await de(r,d,{request:async E=>{const F={method:E.method,headers:{"Content-Type":"application/json",Accept:"application/json",...E.headers}};E.data&&(E.method==="POST"||E.method==="PUT")&&(F.body=JSON.stringify(E.data));const T=await fetch(E.url,F);if(!T.ok)throw new Error(`HTTP ${T.status}: ${T.statusText}`);return{data:await T.json(),status:T.status}}},null),V=e,await o.storage.local.set({lastHeartbeat:new Date().toISOString(),heartbeatStatus:"connected"}),a.debug("Heartbeat sent successfully")}catch(s){a.error("Heartbeat failed",{error:s.message}),s.message&&(s.message.includes("401")||s.message.includes("403"))?(a.warn("Authentication error detected (401/403), clearing data and stopping services"),await O(),await M()):s.message&&s.message.includes("Failed to fetch")&&a.warn("Network error during heartbeat (Failed to fetch) - services will continue, retrying on next interval"),await o.storage.local.set({heartbeatStatus:"error"})}}const fe=async()=>{try{if(!await C()){a.debug("Scheduled Sessions: Skipping polling initialization - authentication validation failed");return}const s=await o.storage.local.get({isUltimate:!1,scheduledSessionsEnabled:!1});if(!s.isUltimate){a.debug("Scheduled Sessions: Skipping polling initialization - Ultimate subscription required");return}if(!s.scheduledSessionsEnabled){a.debug("Scheduled Sessions: Skipping polling initialization - scheduled sessions feature not enabled for this user");return}await o.alarms.clear(B),await o.alarms.create(B,{delayInMinutes:Z,periodInMinutes:Z}),J=!0,a.info("Scheduled Sessions: Polling service initialized",{intervalMinutes:Z})}catch(e){a.error("Scheduled Sessions: Error initializing polling service",{error:e.message})}},be=async()=>{if(J)try{if(a.debug("Scheduled Sessions: Checking for due sessions"),!await C()){a.warn("Scheduled Sessions: Authentication validation failed, stopping polling"),await M();return}if(!D&&p&&p.tabId){a.debug("Scheduled Sessions: Manual swiping session is already active - skipping scheduled session check",{tabId:p.tabId});return}const s=await o.storage.local.get(["uuid","loginToken","userId","loginEmail","isFree","isBasic","isPro","isUltimate","instanceRegistered","scheduledSessionsEnabled"]);if(!s.isUltimate){a.warn("Scheduled Sessions: User does not have Ultimate subscription, stopping polling"),await M();return}if(!s.scheduledSessionsEnabled){a.debug("Scheduled Sessions: Scheduled sessions feature not enabled for this user, stopping polling"),await M();return}const t={uuid:s.uuid,loginToken:s.loginToken,userId:s.userId,loginEmail:s.loginEmail,isFree:s.isFree||!1,isBasic:s.isBasic||!1,isPro:s.isPro||!1,isUltimate:s.isUltimate||!1},n=await le(t,null,null);if(n&&n.data&&n.data.id){const i=n.data;je(i)?(a.info("Scheduled Sessions: Found due session",{sessionName:i.name,site:i.site}),await we(i,t)):a.warn("Scheduled Sessions: Session found but outside execution window (>10 min overdue)",{sessionName:i.name,scheduledAt:i.scheduled_at})}else a.debug("Scheduled Sessions: No due sessions found")}catch(e){a.error("Scheduled Sessions: Error checking for sessions",{error:e.message}),e.message&&(e.message.includes("401")||e.message.includes("403"))?(a.warn("Scheduled Sessions: Authentication error detected (401/403), clearing data and stopping services"),await O(),await M()):e.message&&e.message.includes("Failed to fetch")&&a.warn("Scheduled Sessions: Network error (Failed to fetch) - polling will continue, retrying on next interval")}},je=e=>{try{const s=new Date,t=new Date(e.scheduled_at),i=(s.getTime()-t.getTime())/(1e3*60),r=i>=0&&i<=10;return r||a.warn("Scheduled Sessions: Time window check failed",{now:s.toISOString(),scheduled:t.toISOString(),minutesOverdue:Math.round(i*100)/100,maxAllowedMinutes:10}),r}catch(s){return a.error("Scheduled Sessions: Error validating time window",{error:s.message}),!1}},we=async(e,s)=>{let t=null;try{a.info("Scheduled Sessions: Starting execution of session",{sessionName:e.name});const{startSession:n}=await Promise.resolve().then(()=>De),i={site:e.site,scheduled_session_id:e.id},r=await n(i,s,null,null);if(!r||!r.status)throw new Error("Failed to start session execution on backend");t=r.data.session_id,a.info("Scheduled Sessions: Session started with unified approach",{sessionId:t});const d=Ae(e,s);d.sessionStartedAt=new Date().toISOString(),d.sessionId=t,d.scheduledSessionId=e.id,await _e({action:"auto-swiper-message-backgroundjs-start",options:d},e,t)}catch(n){a.error("Scheduled Sessions: Error executing session",{error:n.message});try{t?await ce(t,{reason:"Scheduled session execution failed",message:n.message,stack:n.stack,timestamp:new Date().toISOString(),session_type:"scheduled"},s,null,null):a.warn("Scheduled Sessions: No session ID available, cannot report failure to backend")}catch(i){a.error("Scheduled Sessions: Failed to report session error",{error:i.message})}}},Ae=(e,s)=>{const t=e.swipe_options||{},n=t.maxSwipes||[50,50],i=Array.isArray(n)?Math.round(Math.random()*(n[1]-n[0])+n[0]):n;return{uuid:s.uuid,isFree:s.isFree,isBasic:s.isBasic,isPro:s.isPro,isUltimate:s.isUltimate,userId:s.userId,userEmail:s.loginEmail,site:e.site,enableAgeFilter:t.enableAgeFilter!==void 0?t.enableAgeFilter:!1,minMaxAge:t.minMaxAge||[18,35],enableHeightFilter:t.enableHeightFilter!==void 0?t.enableHeightFilter:!1,minMaxHeight:t.minMaxHeight||[150,200],enableDistanceFilter:t.enableDistanceFilter!==void 0?t.enableDistanceFilter:!1,maxDistance:t.maxDistance!==void 0?t.maxDistance:50,skipEmptyDistance:t.skipEmptyDistance!==void 0?t.skipEmptyDistance:!1,extendedDistance:t.extendedDistance!==void 0?t.extendedDistance:!1,enableMinPicturesFilter:t.enableMinPicturesFilter!==void 0?t.enableMinPicturesFilter:!1,minPictures:t.minPictures!==void 0?t.minPictures:1,enableMaxSwipesFilter:t.enableMaxSwipesFilter!==void 0?t.enableMaxSwipesFilter:!0,maxSwipes:i,enableLeftSwipesPercentageFilter:t.enableLeftSwipesPercentageFilter!==void 0?t.enableLeftSwipesPercentageFilter:!1,leftSwipePercentages:t.leftSwipePercentages||[25,55],minMaxSwipeTime:t.minMaxSwipeTime||[1,3],enableBreak:t.enableBreak!==void 0?t.enableBreak:!1,breakBetweenSwipes:t.breakBetweenSwipes||[10,20],breakDuration:t.breakDuration||[30,60],enableAutomaticPageReload:t.enableAutomaticPageReload!==void 0?t.enableAutomaticPageReload:!1,reloadPageBetweenSwipes:t.reloadPageBetweenSwipes||[50,100],enableDelayAfterPageReload:t.enableDelayAfterPageReload!==void 0?t.enableDelayAfterPageReload:!1,delayBetweenAfterPageReload:t.delayBetweenAfterPageReload||[3,7],enableRandomUsageSimulation:t.enableRandomUsageSimulation!==void 0?t.enableRandomUsageSimulation:!1,randomUsageSimulation:t.randomUsageSimulation||[0,0],noEmptyDescription:t.noEmptyDescription!==void 0?t.noEmptyDescription:!1,onlyVerifyedProfiles:t.onlyVerifyedProfiles!==void 0?t.onlyVerifyedProfiles:!1,onlyRecentlyActive:t.onlyRecentlyActive!==void 0?t.onlyRecentlyActive:!1,bannedWords:t.bannedWords||[],preferredWords:t.preferredWords||[],requiredWords:t.requiredWords||[],theme:t.theme||"dark",withNotification:t.withNotification!==void 0?t.withNotification:!0,withDebuggerOutput:t.withDebuggerOutput!==void 0?t.withDebuggerOutput:!1,withImageBlocking:t.withImageBlocking!==void 0?t.withImageBlocking:!1,stopOnRightSwipe:t.stopOnRightSwipe!==void 0?t.stopOnRightSwipe:!1,enableGatheringPictureUrls:t.enableGatheringPictureUrls!==void 0?t.enableGatheringPictureUrls:!1,showTinder:t.showTinder!==void 0?t.showTinder:!0,showBumble:t.showBumble!==void 0?t.showBumble:!0,showOkCupid:t.showOkCupid!==void 0?t.showOkCupid:!0,showLovoo:t.showLovoo!==void 0?t.showLovoo:!0,showBadoo:t.showBadoo!==void 0?t.showBadoo:!0,showPoF:t.showPoF!==void 0?t.showPoF:!0,showZoosk:t.showZoosk!==void 0?t.showZoosk:!0,showMatch:t.showMatch!==void 0?t.showMatch:!0,longitude:t.longitude||null,latitude:t.latitude||null,stats:{},swipeLog:[],tabId:null,forceMatch:!1,isScheduledSession:!0,scheduledSessionId:e.id,scheduledSessionName:e.name}},_e=async(e,s,t)=>{a.info("Scheduled Sessions: Processing session start",{site:e.options.site});let n="https://tinder.com/app/recs",i="*://tinder.com/app/*";switch(e.options.site){case"tinder":n="https://tinder.com/app/recs",i="*://*.tinder.com/app/*";break;case"bumble":n="https://bumble.com/app",i="*://*.bumble.com/app/*";break;case"lovoo":n="https://www.lovoo.com/match",i="*://*.lovoo.com/*";break;case"okcupid":n="https://www.okcupid.com/discover",i="*://*.okcupid.com/*";break;case"badoo":n="https://www.badoo.com/encounters",i="*://*.badoo.com/*";break;case"pof":n="https://www.pof.com/meetme",i="*://*.pof.com/*";break;case"zoosk":n="https://www.zoosk.com/personals/search",i="*://*.zoosk.com/personals/*";break;case"match":n="https://match.com",i="*://*.match.com/d/*";break}const r=await o.tabs.query({url:i});if(r.length>0){const d=parseInt(r[0].id.toString());await o.tabs.update(d,{active:!0}),e.options.tabId=d,w=e,P=!0;try{await o.tabs.get(w.options.tabId),await o.tabs.sendMessage(w.options.tabId,{action:"auto-swiper-message-contentjs-ignore-unload"}),await o.tabs.reload(e.options.tabId)}catch{a.warn("Scheduled Sessions: Tab does not exist, skipping sendMessage/reload",{tabId:w.options.tabId})}}else{const d=await o.tabs.create({url:n}),A=parseInt(d.id.toString());e.options.tabId=A,w=e,P=!0}a.info("Scheduled Sessions: Session execution initiated",{tabId:e.options.tabId})};o.alarms.onAlarm.addListener(async e=>{e.name===U?await Q():e.name===B&&await be()});async function C(){const e=await o.storage.local.get({loginToken:"",uuid:"",instanceRegistered:!1});return!e.loginToken||!e.uuid||!e.instanceRegistered?!1:e.loginToken.length<20?(a.warn("Stored token is too short, clearing authentication data"),await O(),!1):!0}async function O(){await o.storage.local.remove(["loginToken","uuid","instanceRegistered","userId","heartbeatStatus","lastHeartbeat","lastActivity","scheduledSessionsEnabled","isFree","isBasic","isPro","isUltimate"]),a.info("Authentication data cleared from storage")}o.runtime.onStartup.addListener(async()=>{await C()?(a.info("Extension startup - user is authenticated, starting services"),await Y()):a.info("Extension startup - user not authenticated, services not started")}),o.runtime.onInstalled.addListener(async()=>{a.info("Extension installed/updated - clearing any stale authentication data"),await O(),a.info("Extension installed - services not started (user needs to login)")});async function Y(){if(a.info("Starting authenticated services"),!await C()){a.warn("Authentication validation failed, not starting services");return}await me();const s=await o.storage.local.get({isUltimate:!1,scheduledSessionsEnabled:!1});s.isUltimate&&s.scheduledSessionsEnabled?(a.info("User has Ultimate subscription and scheduled sessions enabled, starting polling"),await fe()):a.debug("Scheduled session polling not started - Ultimate subscription and scheduled sessions feature required")}async function M(){a.info("Stopping authenticated services"),await o.alarms.clear(U),await o.alarms.clear(B),J=!1,V=0,await o.storage.local.set({heartbeatStatus:"disconnected",lastActivity:new Date().toISOString()}),a.info("Authenticated services stopped")}typeof module<"u"&&module.exports&&(module.exports={initializeHeartbeat:me,performHeartbeatCheck:Q,getBrowserInfo:pe,getExtensionStatus:he,initializeScheduledSessionPolling:fe,checkForScheduledSessions:be,executeScheduledSession:we,convertScheduledSessionToSwipeOptions:Ae,startAuthenticatedServices:Y,stopAuthenticatedServices:M,validateStoredAuthentication:C,clearAuthenticationData:O})})();
